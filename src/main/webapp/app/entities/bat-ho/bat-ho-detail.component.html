<div *ngIf="batHo">
    <h2>
        <span>Bát họ {{batHo.hopdong.mahopdong}}</span>
    </h2>
    <hr>
    <jhi-alert-error></jhi-alert-error>

    <div class="row">
        <div class="col-md-4">
            <p-galleria [images]="images" panelWidth="100%" panelHeight="313" [showCaption]="false"></p-galleria>
        </div>
        <div class="col-md-4">
            <div class="row">
                <div class="col-md-2">
                    <span class="fa fa-address-card-o fa-4x text-primary"></span>
                </div>
                <div class="col-md-10" style="font-size:18px">
                    <div class="row">
                        <div class="col-md-12">
                            <b>Khách hàng</b>:
                            <a [routerLink]="['../../khach-hang', batHo.hopdong.khachHangId ]">{{batHo.hopdong.khachHangTen}}</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <b>ID</b>:
                            <a [routerLink]="['../../khach-hang', batHo.hopdong.khachHangId ]">{{batHo.hopdong.khachHangId}}</a>
                            </td>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-top:100px">
                <div class="col-md-2">
                    <span class="fa fa-paypal fa-5x text-primary"></span>
                </div>
                <div class="col-md-10" style="font-size:18px">
                    <div class="row">
                        <div class="col-md-12">
                            <span class="fa fa-money text-primary"></span>
                            <b>Bát họ</b>: {{batHo.tongtien |currency : 'VND' : true : '2.0-0'}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <span class="fa fa-calendar text-primary"></span>
                            <b>Họ từ ngày</b>: {{batHo.hopdong.ngaytao | date:"dd/MM/yyyy"}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-danger">
                            <span class="fa fa-thumbs-o-down text-danger"></span>
                            <b>Số nợ còn lại</b>: {{tienNo-tienTra |currency : 'VND' : true : '1.0-0'}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="row">
                <div class="col-md-2">
                    <span class="fa fa-credit-card text-primary fa-5x"></span>
                </div>
                <div class="col-md-10" style="font-size:18px">
                    <div class="row">
                        <div class="col-md-12">
                            <span class="fa fa-sign-out text-primary"></span>
                            <b>Số tiền đưa khách</b>: {{batHo.tienduakhach |currency : 'VND' : true : '1.0-0'}}
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <span class="fa fa-money text-primary"></span>
                                <b>Tổng tiền phải đóng</b>: {{batHo.tongtien |currency : 'VND' : true : '1.0-0'}}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 text-success">
                                <span class="fa fa-check-square-o text-success"></span>
                                <b>Đã đóng</b>: {{batHo.tongtien-tienchuadong |currency : 'VND' : true : '1.0-0'}}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 text-warning">
                                <span class="fa fa-minus-square-o text-warning"></span>
                                <b>Còn lại</b>: {{tienchuadong |currency : 'VND' : true : '1.0-0'}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <button type="submit" (click)="previousState()" class="btn btn-info">
        <span class="fa fa-arrow-left"></span>&nbsp;
        <span jhiTranslate="entity.action.back"> Back</span>
    </button>
    <!-- <button type="button" [routerLink]="['/', { outlets: { popup: 'bat-ho/'+ batHo.id + '/edit'} }]" replaceUrl="true" queryParamsHandling="merge"
        class="btn btn-primary">
        <span class="fa fa-pencil"></span>&nbsp;
        <span jhiTranslate="entity.action.edit"> Edit</span>
    </button> -->
    <button type="button" (click)="hienDongHD()" class="btn btn-danger">
        <span class="fa-ban fa"></span>&nbsp; Đóng hợp đồng
    </button>
    <p-dialog modal="true" [(visible)]="dongHD">
        <p-header>
            Bạn chuẩn bị đóng hợp đồng {{batHo.hopdong.mahopdong}}
        </p-header>
        Số tiền còn phải đóng: {{tienchuadong |currency : 'VND' : true : '1.0-0'}}
        <br/> Số tiền còn nợ: {{tienNo-tienTra |currency : 'VND' : true : '1.0-0'}}
        <br/> Bạn có chắc chắn muốn đóng hợp đồng này?
        <p-footer>
            <button (click)="dongHopDong()" type="button" class="btn btn-danger">
                <span class="fa fa-check"></span>&nbsp; Đóng hợp đồng
            </button>
            <button type="button" (click)="dongDongHD()" class="btn btn-success">
                <span class="fa fa-close"></span>&nbsp; Hủy
            </button>
        </p-footer>
    </p-dialog>
    <p-tabView>
        <p-growl [(value)]="msgs"></p-growl>
        <p-tabPanel header="Lịch đóng tiền">
            <p-table [value]="lichSuDongTiens" [paginator]="true" [rows]="8" [(selection)]="selected" dataKey="id" (onRowSelect)="onRowSelect($event)"
                (onRowUnselect)="onRowUnselect($event)">
                <ng-template pTemplate="header">
                    <tr>
                        <th colspan="2">
                            <span>Ngày họ</span>
                        </th>
                        <th>
                            <span>Trạng Thái</span>
                        </th>
                        <th>
                            <span>Tiền họ</span>
                        </th>
                        <th>
                            <span>Tiền khách trả</span>
                        </th>
                        <th>
                            <span>Ngày giao dịch</span>
                        </th>
                        <th>
                            <span>Đóng tiền</span>
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-lichSuDongTien>
                    <!-- <tr [pSelectableRow]="lichSuDongTien" [class.ng-star-inserted]="{true}"> -->
                    <tr [pSelectableRow]="lichSuDongTien">
                        <td>{{lichSuDongTien.ngaybatdau | date:"dd/MM/yyyy"}}</td>
                        <td>{{lichSuDongTien.ngayketthuc | date:"dd/MM/yyyy"}}</td>
                        <td>
                            <span jhiTranslate="{{'servertdjhipApp.lichSuDongTien.' + lichSuDongTien.trangthai}}">{{lichSuDongTien.trangthai}}</span>
                        </td>

                        <td>{{lichSuDongTien.sotien |currency : 'VND' : true : '1.0-0'}}</td>

                        <td>{{lichSuDongTien.sotien |currency : 'VND' : true : '1.0-0'}}</td>
                        <td>{{lichSuDongTien.ngaygiaodich | date:"dd/MM/yyyy"}}</td>
                        <td>
                            <p-tableCheckbox [value]="lichSuDongTien" [disabled]="lichSuDongTien.trangthai=='DADONG'"></p-tableCheckbox>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
            <p-dialog modal="true" [(visible)]="dongTien">
                <p-header>
                    Đóng tiền cho hợp đồng {{batHo.hopdong.mahopdong}}
                </p-header>
                Số tiền đóng: {{lichSuDongTien.sotien |currency : 'VND' : true : '1.0-0'}}
                <br/> Bạn có chắc chắn muốn đóng tiền?
                <p-footer>
                    <button type="button" class="btn btn-success">
                        <span class="fa fa-check"></span>&nbsp; Xác nhận
                    </button>
                    <button type="button" (click)="dongDongTien()" class="btn btn-danger">
                        <span class="fa fa-close"></span>&nbsp; Hủy
                    </button>
                </p-footer>
            </p-dialog>
        </p-tabPanel>
        <p-tabPanel header="Ghi nợ">
            <div class="row justify-content-center">
                <div class="col-md-4">
                    <table class="table table-bordered">
                        <thead>
                            <th colspan="2" class="bolder-table-first">Khách hàng nợ lãi</th>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Số tiền nợ: </td>
                                <td>
                                    <p-spinner [step]="1000000" thousandSeparator="." placeholder="0" [min]="0" [inputStyle]="{'width':'100%'}" pKeyFilter="pnum"
                                        [(ngModel)]="ghiNo.sotien" class="form-control" name="tienno" id="field_tienno" required></p-spinner>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" class="bolder-table-last">
                                    <button (click)="saveNo()" class="btn btn-danger float-right">
                                        <span class="fa fa-balance-scale"></span>
                                        Ghi nợ</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </p-tabPanel>
        <p-tabPanel header="Trả nợ">
            <div class="row justify-content-center">
                <div class="col-md-4">
                    <table class="table table-bordered">
                        <thead>
                            <th colspan="2" class="bolder-table-first">Khách hàng trả nợ</th>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Số tiền trả: </td>
                                <td>
                                    <p-spinner [step]="1000000" thousandSeparator="." placeholder="0" [min]="0" [inputStyle]="{'width':'100%'}" pKeyFilter="pnum"
                                        [(ngModel)]="ghiNo.sotien" class="form-control" name="tientra" id="field_tientra" [disabled]="tienNo-tienTra == 0"
                                        required></p-spinner>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" class="bolder-table-last">
                                    <button (click)="saveTraNo()" class="btn btn-success float-right">
                                        <span class="fa fa-balance-scale"></span>
                                        Trả nợ</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </p-tabPanel>
        <p-tabPanel header="Lịch sử">
            <div class="row">
                <div class="col-md-5 table-bordered">
                    <div class="row">
                        <div class="col-md-12">
                            <span class="ui-float-label" style="marin-top:10px">
                                <textarea id="float-input" [rows]="5" [cols]="87" pInputTextarea></textarea>
                                <label for="float-input">Ghi chú</label>
                            </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <button class="btn btn-success float-right">
                                <span class="fa fa-save"></span>
                                Lưu</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-7">
                    <h3>Lịch sử thao tác</h3>
                    <br />
                    <p-table [value]="lichSuThaoTacHopDongs" [paginator]="true" [rows]="5" dataKey="id">
                        <ng-template pTemplate="header">

                            <th>Ngày</th>
                            <th>Nhân viên</th>
                            <th>Số tiền ghi nợ</th>
                            <th>Số tiền ghi trả</th>
                            <th>Nội dung</th>
                        </ng-template>
                        <ng-template pTemplate="body" let-lichSuThaoTacHopDong>
                            <tr [pSelectableRow]="lichSuThaoTacHopDong">
                                <td>{{lichSuThaoTacHopDong.thoigian | date: "dd/MM/yyyy lúc hh:mm:ss"}}</td>
                                <td>{{lichSuThaoTacHopDong.nhanVienTen}}</td>
                                <td>{{lichSuThaoTacHopDong.soTienGhiNo}}</td>
                                <td>{{lichSuThaoTacHopDong.soTienGhiCo}}</td>
                                <td>{{lichSuThaoTacHopDong.noidung}}</td>

                            </tr>
                        </ng-template>
                        </table>
                </div>
            </div>
        </p-tabPanel>
        <p-tabPanel header="Đảo họ">
            <div class="row justify-content-center" style="background-color: #e3e3e3">
                <div class="col-md-4" style="background-color:white">
                    <table class="table table-bordered">
                        <tbody>
                            <tr>
                                <td>Ngày đảo họ:</td>
                                <td>
                                    <p-calendar></p-calendar>
                                </td>
                            </tr>
                            <tr>
                                <td>Bát họ mới:</td>
                                <td>
                                    <p-spinner [step]="1000000" thousandSeparator="." placeholder="0" [min]="0" [inputStyle]="{'width':'100%'}" pKeyFilter="pnum"
                                        [(ngModel)]="batHoDao.tongtien" class="form-control" name="tongtien" id="field_tongtien"
                                        pTooltip="Nhập  số tiền khách hàng phải đóng (Đơn vị: VNĐ)" tooltipPosition="top" tooltipEvent="hover"
                                        required></p-spinner>
                                </td>
                            </tr>
                            <tr>
                                <td>Tiền đưa khách:</td>
                                <td>
                                    <p-spinner [step]="1000000" thousandSeparator="." placeholder="0" [min]="0" [inputStyle]="{'width':'100%'}" pKeyFilter="pnum"
                                        [(ngModel)]="batHoDao.tienduakhach" class="form-control" name="tienduakhach" id="field_tienduakhach"
                                        pTooltip="Nhập số tiền khách nhận
                                        (Tiền lãi - chưa tính bát họ gốc)
                                        (Đơn vị: VNĐ)" tooltipPosition="top" tooltipEvent="hover" required></p-spinner>
                                </td>
                            </tr>
                            <tr>
                                <td>Bốc trong vòng:</td>
                                <td>
                                    <input [(ngModel)]="batHoDao.tongsongay" [min]='0' type="number" pKeyFilter="pnum" class="form-control" name="tongsongay"
                                        id="field_tongsongay" pInputText>
                                </td>
                            </tr>
                            <tr>
                                <td>Số ngày đóng tiền:</td>
                                <td>
                                    <input [(ngModel)]="batHoDao.chuky" type="number" [min]='0' pKeyFilter="pnum" class="form-control" name="chuky" id="field_chuky"
                                        pInputText>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">Số tiền đưa khách thực tế : {{batHoDao.tienduakhach |currency : 'VND' : true : '1.0-0'}}-{{tienchuadong
                                    |currency : 'VND' : true : '1.0-0'}}-{{tienNo-tienTra |currency : 'VND' : true : '1.0-0'}}={{batHoDao.tienduakhach-tienchuadong-(tienNo-tienTra)
                                    |currency : 'VND' : true : '1.0-0'}}</td>
                            </tr>
                            <tr>
                                <td colspan="2" class="text-center bolder-table-last">
                                    <button (click)="daoHo()" class="btn btn-primary">
                                        <span class="fa fa-refresh"></span>
                                        Đảo họ</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </p-tabPanel>
        <p-tabPanel header="Chứng từ">
            <div class="row">
                <div class="col-md-12">
                    <p-fileUpload name="myfile[]" url="./upload.php" multiple="multiple" accept="image/*" maxFileSize="1000000"></p-fileUpload>
                </div>
            </div>
        </p-tabPanel>
    </p-tabView>
</div>