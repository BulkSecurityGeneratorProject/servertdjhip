<div class="container">
  <!--RIGHT MENUTOP CONTENT-->
  <!--/RIGHT MENUTOP CONTENT-->
  <!--FOOTER CONTENT-->
  <link rel="stylesheet" href="/Scripts/themes/default/style.min.css">

<script type="text/javascript" src="/Template/plugins/uniform/jquery.uniform.min.js"></script>
<!-- Styled radio and checkboxes -->
<script type="text/javascript" src="/Template/plugins/select2/select2.min.js"></script>

<h3>Phân quyền cho nhân viên :</h3>
<div class="col-md-2" style="padding-left: 0px; padding-bottom: 15px; ">

<div class="select2-container col-md-12 full-width-fix" id="s2id_sl-group"><a href="javascript:void(0)" onclick="return false;" class="select2-choice" tabindex="-1">   <span class="select2-chosen">aqwsq</span><abbr class="select2-search-choice-close"></abbr>   <span class="select2-arrow"><b></b></span></a><input class="select2-focusser select2-offscreen" type="text" id="s2id_autogen1"></div><select id="sl-group" class="select2-select-00 col-md-12 full-width-fix select2-offscreen" name="select" tabindex="-1">
<option value="54120">aqwsq</option>
</select>
</div>
<div class="col-md-1">
<button id="btn-update" class="btn btn-primary">
Lưu
</button>
</div>
<!--Box loading-->
<div class="col-md-8" id="loading" style="margin-top: 7px; display: none;">
<img src="/Template/images/loading.gif">
</div>
<div class="widget-content" id="result-search"><script src="/Scripts/jstree.min.js"></script>

<script type="text/javascript">

var treeModel = [{"id":"1","text":"Cầm đồ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":[{"id":"67","text":"Xem thông tin quỹ tiền mặt, tiền đang vay, lãi dự kiến, lãi đã thu","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"11","text":"Xem danh sách hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"12","text":"Tạo mới hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"70","text":"Sửa ngày vay","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"13","text":"Sửa hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"60","text":"Xóa hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"14","text":"Đóng lãi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"15","text":"Hủy đóng lãi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"16","text":"Vay thêm gốc","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"63","text":"Trả bớt gốc","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"17","text":"Chuộc đồ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"71","text":"Sửa ngày chuộc đồ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"18","text":"Hủy chuộc đồ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"19","text":"Ghi nhận nợ lãi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"75","text":"Thanh Lý Đồ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"}],"Link":"///"},{"id":"2","text":"Vay lãi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":[{"id":"68","text":"Xem thông tin quỹ tiền mặt, tiền đang vay, lãi dự kiến, lãi đã thu","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"20","text":"Xem danh sách hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"21","text":"Tạo mới hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"72","text":"Sửa ngày vay","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"22","text":"Sửa hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"61","text":"Xóa hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"23","text":"Đóng lãi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"24","text":"Hủy đóng lãi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"25","text":"Vay thêm gốc","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"64","text":"Trả bớt gốc","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"26","text":"Gia hạn HĐ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"27","text":"Đóng hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"73","text":"Sửa ngày đóng hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"28","text":"Hủy đóng hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"29","text":"Ghi nhận nợ lãi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"}],"Link":"///"},{"id":"3","text":"Bát họ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":[{"id":"69","text":"Xem thông tin quỹ tiền mặt, tiền đang vay, lãi dự kiến, lãi đã thu","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"30","text":"Xem danh sách hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"31","text":"Tạo mới hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"32","text":"Sửa hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"62","text":"Xóa hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"33","text":"Đóng họ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"34","text":"Hủy đóng họ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"35","text":"Đóng hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"36","text":"Hủy đóng hợp đồng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"37","text":"Ghi nhận nợ tiền họ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"}],"Link":"///"},{"id":"4","text":"Khách hàng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":[{"id":"38","text":"Danh sách khách hàng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"66","text":"Khách cần vay","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"76","text":"Check thông tin khách hàng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"}],"Link":"///"},{"id":"5","text":"Quản lý cửa hàng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":[{"id":"77","text":"Tổng Quát Chuỗi Cửa Hàng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"39","text":"Thông tin chi tiết cửa hàng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"40","text":"Danh sách cửa hàng","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"41","text":"Cấu hình hàng hóa","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"42","text":"Nhập tiền quỹ đầu ngày","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"}],"Link":"///"},{"id":"6","text":"Quản lý thu chi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":[{"id":"43","text":"Chi hoạt động","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"44","text":"Thu hoạt động","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"65","text":"Xóa phiếu thu hoặc phiếu chi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"}],"Link":"///"},{"id":"7","text":"Quản lý nguồn vốn","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"8","text":"Quản lý nhân viên","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":[{"id":"45","text":"Danh sách nhân viên","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"46","text":"Phân quyền nhân viên","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"}],"Link":"///"},{"id":"9","text":"Thống kê","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":[{"id":"47","text":"Thu tiền vay lãi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"48","text":"Thu tiền họ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"}],"Link":"///"},{"id":"10","text":"Báo cáo","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":[{"id":"49","text":"Sổ quỹ tiền mặt","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"58","text":"Tổng kết giao dịch","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"51","text":"Tổng kết lợi nhuận","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"50","text":"Chi tiết tiền lãi","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"57","text":"Báo cáo đang cho vay","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"74","text":"Báo cáo hàng chờ thanh lý","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"54","text":"Báo cáo chuộc đồ, đóng HĐ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"55","text":"Báo cáo thanh lý đồ","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"59","text":"Báo cáo hợp đồng đã xóa","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"56","text":"Báo cáo tin nhắn","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"52","text":"Bàn giao ca","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"},{"id":"53","text":"Dòng tiền theo ngày","state":{"opened":true,"disabled":false,"selected":false},"IsMenu":null,"ControllerName":null,"ActionName":null,"children":null,"Link":"///"}],"Link":"///"}];

// html demo
$('#html').on('changed.jstree', function (e, data) {
var i, j, arrID = [];
var nodeSelect;
var parentNode;

for(i = 0, j = data.selected.length; i < j; i++) {
nodeSelect = data.instance.get_node(data.selected[i]);
if($.inArray(nodeSelect.id, arrID)==-1)
{
  // Kiểm tra cha của node hiện tại, nếu là # có nghĩa là nó ko có cha
  if(nodeSelect.parent !='#')
  {
      // Lấy node cha của node hiện tại
      parentNode=data.instance.get_node(nodeSelect.parent);

      if($.inArray(parentNode.id, arrID)==-1)
      {
          arrID.push(parentNode.id);
      }
  }// Hết xử lý nút cha

  // Chèn nút hiện tại
  arrID.push(nodeSelect.id);
}
}
//$('#event_result').html('Selected: ' + arrID.join(', '));
$('#hddArrID').val(arrID.join(','));
}).jstree({
"checkbox" : {
"keep_selected_style" : false,
},
"plugins":["checkbox"],
"core":
{
'data':treeModel
}
});
</script>
</div>
<script>
$('.select2-select-00').select2();
$('#sl-group').on("change", function () { GetPermission(); });
// Ajax Submit Form :
$(document).ready(function () {
GetPermission();
});
function GetPermission()
{
var UserID = $("#sl-group").val();
$("#loading").css("display", "");
$.ajax({
type: "POST",
url: "/Staff/GetPermission",
data: { UserID: UserID }
}).done(function (data) {
$("#loading").css("display", "none");
$("#result-search").html(data);
})
}

$("#btn-update").click(function () {
var UserID = $("#sl-group").val();
var strArrID = $('#hddArrID').val();
$("#loading").css("display", "");
$.ajax({
type: "POST",
url: "/Staff/SavePermission",
data: { UserID: UserID, strArrID: strArrID }
}).done(function (data) {
$("#loading").css("display", "none");
if (data.Error == 0) {
  NotyA('Cập nhập quyền thành công !', 'success');
} else {
  NotyA(data.Message, 'error');
}
})
});
</script>
  <!--FOOTER CONTENT-->
</div>